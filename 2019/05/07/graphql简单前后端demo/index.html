<!DOCTYPE html>
<html lang="zh-CN">





<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content>
  <meta name="author" content="Justshi">
  <meta name="keywords" content>
  <title>GraphQL简单前后端Demo ~ SHIV STEP</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css">
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css">

<link rel="stylesheet" href="/css/main.css">


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css">


</head>


<body>
  <header style="height: 66vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>SHIV STEP</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" false
         style="background: url('/img/default.jpeg')no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期二, 2019-05-7日, 20:46:10
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    1.3k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      5 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <blockquote>
<p>之前组内就有说过<code>graphql</code>,在做影像字段配置的时候，当时就提过使用<code>graphql</code>来实现，但是综合考虑，并没有采用。所以趁着有空，自己写一个<code>demo</code>体验以下!</p>
</blockquote>
<h2 id="一-什么是graphql"><a href="#一-什么是graphql" class="headerlink" title="一 什么是graphql"></a>一 什么是graphql</h2><p>借用官网的话——一种用于 API 的查询语言。</p>
<blockquote>
<p>GraphQL 既是一种用于 API 的查询语言也是一个满足你数据查询的运行时。 GraphQL 对你的 API 中的数据提供了一套易于理解的完整描述，使得客户端能够准确地获得它需要的数据，而且没有任何冗余，也让 API 更容易地随着时间推移而演进，还能用于构建强大的开发者工具。</p>
</blockquote>
<p>一个 GraphQL 服务是通过定义类型和类型上的字段来创建的，然后给每个类型上的每个字段<strong>提供解析函数</strong>。为每一个字段都提供一个解析函数，听起来工作量挺大，其实已经有一些很好的工具会帮我们自动解析简单字段类型！</p>
<p>接下来直接上例子~</p>
<h2 id="二-后台服务-springboot-graghql"><a href="#二-后台服务-springboot-graghql" class="headerlink" title="二 后台服务 springboot + graghql"></a>二 后台服务 springboot + graghql</h2><p><strong>1 pom.xml</strong></p>
<pre><code class="xml">&lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.0.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!-- graphql相关 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
            &lt;artifactId&gt;graphql-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;5.0.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- GraphiQL tool for schema introspection and query debugging 
          能提供一个/graphiql页面，提供查询，方面测试
        --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
            &lt;artifactId&gt;graphiql-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;5.0.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- 能够从GraphQL的模式定义*.graphqls文件构建出对应的Java的POJO类型对象.会将类路径中任何名为*.graphqls的文件用于提供模式定义 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
            &lt;artifactId&gt;graphql-java-tools&lt;/artifactId&gt;
            &lt;version&gt;5.2.4&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<p><strong>2 demoapi.graphqls</strong></p>
<p>在类路径下新建demoapi.graphqls文件，提供schema定义，graphql-java-tools会负责解析。</p>
<pre><code>type Query {
    school(id: ID): School
    student(id: ID): Student
}

type School {
    id: Int
    name: String
    ranking: Int
}

type Student {
    id: Int
    name: String
    age: Int
    classId: Int
}
</code></pre><p><strong>3 获取数据</strong></p>
<blockquote>
<p>需要实现GraphQLQueryResolver接口</p>
</blockquote>
<pre><code class="java">@Component
public class Query implements GraphQLQueryResolver {
    @Autowired
    private SchoolMapper schoolMapper;

    @Autowired
    private StudentMapper studentMapper;

    public School getSchool(Integer id) {
        return schoolMapper.getById(id);
    }

    public Student student(Integer id) {
        return studentMapper.getById(id);
    }
}
</code></pre>
<p>因为将<code>graphql-spring-boot-starter</code>作为依赖项添加到引导应用程序，并且应用程序中有GraphQLSchema bean，则可以在/graphql上访问servlet。</p>
<p><strong>4 启动程序</strong></p>
<p>启动后台，访问<code>http://localhost:8080/graphiql</code>，查询接口：</p>
<p><img src="/2019/05/07/graphql简单前后端demo/./graphql01.jpg" srcset="/img/loading.gif" alt="graphql01"></p>
<p><img src="/2019/05/07/graphql简单前后端demo/./graphql02.jpg" srcset="/img/loading.gif" alt="graphql02"></p>
<p>如图，后台接口不做更改，前端可以根据自己需求获取自己需要的数据，而且返回的数据结构跟你的请求结构相似！<strong>这个页面工具对能询到哪些字段信息有很好的提示功能。</strong></p>
<p>当然，对于构建后台api有多种方式，如：</p>
<pre><code class="java">@Bean
    GraphQLSchema schema() {
        return GraphQLSchema.newSchema()
                .query(GraphQLObjectType.newObject()
                        .name(&quot;query&quot;)
                        .field(field -&gt; field
                                .name(&quot;test&quot;)
                                .type(Scalars.GraphQLString)
                                .dataFetcher(environment -&gt; &quot;response&quot;)
                        )
                        .build())
                .build();
    }
</code></pre>
<p>这种方式，需要我们针对每一个字段提供一个解析函数，如上面的<code>dataFetcher</code>.这对于一些字段很多，返回字段名称很java对象的字段名称一致的，这样难免很乏所。对于这种情况，第一种方式——利用<code>graphql-java-tools</code>还是更加便捷一些。</p>
<p>好了，后端接口就写到这块，前端我们应该发送请求过来了？</p>
<p>首先我们可以看一下，上面的请求页面——<code>Graphiql</code>是怎么发送请求的，打开chrome的调试工具：</p>
<p><img src="/2019/05/07/graphql简单前后端demo/./graphql03.jpg" srcset="/img/loading.gif" alt="graphql03"></p>
<p>发现，是post请求，我们的请求参数如上图所示。所以发到后台的数据格式有一定的要求。比较庆幸的是，有一些很优秀的前端工具帮我做了这些，比如：<code>apollo-client</code>, <code>graphql.js</code>等，这里我使用<code>graphql.js</code>，因为它更轻量级。</p>
<h2 id="三-web页面"><a href="#三-web页面" class="headerlink" title="三 web页面"></a>三 web页面</h2><p>前端搭建一个简单的vue项目：</p>
<p>安装<code>graphql.js</code>:</p>
<pre><code class="bash">npm install graphql.js --save
</code></pre>
<p>为了方便在vue中使用，做下列操作：</p>
<p>1 创建<code>GraphQLProvider.js</code></p>
<pre><code class="js">import graphql from &#39;graphql.js&#39;

export default {
  install (Vue, url, options) {
    Vue.mixin({
      created () {
        this._graph = graphql(url, options)
      }
    })
    Object.defineProperty(Vue.prototype, &#39;$graph&#39;, {
      get () {
        return this._graph
      }
    })
  }
}
</code></pre>
<p>2 在<code>main.js</code>中引入</p>
<pre><code class="js">import GraphQLProvider from &#39;./util/GraphQLProvider&#39;
Vue.use(GraphQLProvider, &#39;http://localhost:8080/graphql&#39;, {
  // method: &#39;POST&#39;, 默认就是post
  alwaysAutodeclare: true,
  asJSON: true,
  debug: true,
  headers: {
    // headers...
  }
})
</code></pre>
<p>然后就可以在页面使用<code>this.$graph</code>去使用了。实际操作：</p>
<pre><code class="js">export default {
  name: &#39;test&#39;,
  data () {
    return {
      msg: &#39;&#39;
    }
  },
  mounted () {
    this.test()
  },
  methods: {
    test () {
      let param = `
        school(id: 1) {
          name
          id
        }
      `
      this.$graph.query.run(param).then(response =&gt; {
        console.log(response)
        this.msg = response
      })
    }
  }
}
</code></pre>
<p>ok，刷新页面：</p>
<p><img src="/2019/05/07/graphql简单前后端demo/./graphql04.jpg" srcset="/img/loading.gif" alt="graphql04"></p>
<p>到此，我们可以改变变量param请求参数，就可以获取自己想要的信息了。这里这是一个简单的演示，关于更多的信息，可以参考下面。</p>
<p><a href="https://github.com/justsme/graphql-simple-demo.git" target="_blank" rel="noopener">代码示例GitHub</a><br><strong>更多信息</strong></p>
<ol>
<li><a href="http://graphql.cn/" target="_blank" rel="noopener">Graphql官网</a></li>
<li><a href="https://github.com/f/graphql.js" target="_blank" rel="noopener">graphql.js</a></li>
<li><a href="https://github.com/apollographql/apollo-client" target="_blank" rel="noopener">apollo-client</a></li>
<li><a href="https://github.com/graphql-java-kickstart/graphql-spring-boot" target="_blank" rel="noopener">graphql-spring-boot</a></li>
<li><a href="https://github.com/graphql-java/graphql-java" target="_blank" rel="noopener">graphql-java</a></li>
</ol>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/GraphQL">GraphQL</a>
                
                  <a class="hover-with-bg" href="/tags/spring-boot">spring-boot</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <script defer src="https://utteranc.es/client.js"
          repo="justsme/justsme.github.io"
          issue-term="pathname"
  
          label="utterances"
    
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv"></span>总访问量 
          <span id="busuanzi_value_site_pv"></span> 次&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv"></span>总访客数 
            <span id="busuanzi_value_site_uv"></span> 人&nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  <script src="/js/post.js" ></script>
  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
    <script>
      $(document).ready(function () {
        tocbot.init({
          tocSelector: '#tocbot',
          contentSelector: '.post-content',
          headingSelector: 'h1,h2,h3,h4,h5,h6',
          linkClass: 'tocbot-link',
          activeLinkClass: 'tocbot-active-link',
          listClass: 'tocbot-list',
          isCollapsedClass: 'tocbot-is-collapsed',
          collapsibleClass: 'tocbot-is-collapsible',
          scrollSmooth: true,
        });
      });
    </script>
  



  <script src="/lib/smoothscroll/SmoothScroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "GraphQL简单前后端Demo&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>












</body>
</html>
